<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Vditor Markdown Editor (Split View)</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vditor@3.10.4/dist/index.css" />
  <style>
    body,
    html {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
    }

    #toolbar {
      padding: 10px;
      background: #f5f5f5;
      border-bottom: 1px solid #ddd;
      display: flex;
      gap: 10px;
    }

    #toolbar button {
      padding: 6px 12px;
      font-size: 14px;
      cursor: pointer;
      border: 1px solid #ccc;
      border-radius: 4px;
      background: white;
    }

    #toolbar button:hover {
      background: #e9e9e9;
    }

    #vditor {
      height: calc(100vh - 50px);
      /* å‡å» toolbar é«˜åº¦ */
    }
  </style>
</head>

<body>
  <div id="toolbar">
    <button id="load-btn">ğŸ”„ è¯»å–ï¼ˆReloadï¼‰</button>
    <button id="save-btn">ğŸ’¾ ä¿å­˜ï¼ˆCtrl+Sï¼‰</button>
  </div>
  <div id="vditor"></div>

  <script src="https://cdn.jsdelivr.net/npm/vditor@3.10.4/dist/index.min.js"></script>
  <script>
    const initialMd = "{{INITIAL_MD}}";

    const vditor = new Vditor('vditor', {
      mode: 'sv', // ğŸ‘ˆ split view: å·¦ç¼–è¾‘ï¼Œå³é¢„è§ˆ
      height: '100%',
      placeholder: 'Write your markdown here...',
      toolbarConfig: {
        pin: true
      },
      cache: {
        enable: false
      },
      value: initialMd,
      after: () => {
        console.log('Vditor loaded in split mode');
      }
    });

    // ä¿å­˜å‡½æ•°
    async function saveContent() {
      const content = vditor.getValue();
      try {
        const res = await fetch('/save', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ content })
        });
        if (res.ok) {
          alert('âœ… ä¿å­˜æˆåŠŸï¼');
        } else {
          alert('âŒ ä¿å­˜å¤±è´¥: ' + await res.text());
        }
      } catch (err) {
        alert('âŒ ç½‘ç»œé”™è¯¯: ' + err.message);
      }
    }

    // è¯»å–ï¼ˆé‡æ–°åŠ è½½ï¼‰å‡½æ•°
    async function loadContent() {
      try {
        const res = await fetch('/content');
        if (!res.ok) throw new Error(await res.text());
        const content = await res.text();
        vditor.setValue(content);
        alert('âœ… å·²é‡æ–°åŠ è½½æœ€æ–°æ–‡ä»¶å†…å®¹');
      } catch (err) {
        alert('âŒ åŠ è½½å¤±è´¥: ' + err.message);
      }
    }
    // ç»‘å®šæŒ‰é’®äº‹ä»¶
    document.getElementById('save-btn').addEventListener('click', saveContent);
    document.getElementById('load-btn').addEventListener('click', loadContent);
  </script>
</body>

</html>